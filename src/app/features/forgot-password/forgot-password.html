<div class="min-h-screen flex items-center justify-center bg-gray-950 p-4">
  <div class="w-full max-w-md p-8 rounded-2xl bg-gray-900 shadow-xl border border-white/10">
    
    <!-- Header din√°mico seg√∫n el paso -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-yellow-400 mb-2">
        @if (currentStep() === RecoveryStep.REQUEST) {
          Recuperar Contrase√±a
        } @else if (currentStep() === RecoveryStep.VERIFY) {
          Verificar C√≥digo
        } @else {
          Nueva Contrase√±a
        }
      </h1>
      <p class="text-white/60 text-sm">
        @if (currentStep() === RecoveryStep.REQUEST) {
          Ingresa tu correo para recibir un c√≥digo
        } @else if (currentStep() === RecoveryStep.VERIFY) {
          Ingresa el c√≥digo enviado a tu WhatsApp
        } @else {
          Crea tu nueva contrase√±a segura
        }
      </p>
    </div>

    <!-- Mensajes de error -->
    @if (error()) {
      <div class="mb-4 p-4 rounded-lg bg-red-500/10 border border-red-500/30 text-red-300 text-sm">
        <strong>‚ùå Error:</strong> {{ error() }}
      </div>
    }

    <!-- Mensajes de √©xito -->
    @if (successMessage()) {
      <div class="mb-4 p-4 rounded-lg bg-green-500/10 border border-green-500/30 text-green-300 text-sm">
        <strong>‚úÖ</strong> {{ successMessage() }}
      </div>
    }

    <!-- PASO 1: Solicitar c√≥digo -->
    @if (currentStep() === RecoveryStep.REQUEST) {
      <form (submit)="requestRecovery($event)" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-white/70 mb-2">
            Correo electr√≥nico
          </label>
          <input
            [value]="email()"
            (input)="onEmailChange($event)"
            type="email"
            required
            placeholder="tu@email.com"
            autofocus
            class="w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10
                   outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-400/20
                   transition-all">
          <p class="text-xs text-white/40 mt-1">
            Te enviaremos un c√≥digo de verificaci√≥n por WhatsApp
          </p>
        </div>

        <button
          type="submit"
          [disabled]="loading()"
          class="w-full py-3 rounded-xl bg-yellow-400 text-black font-semibold
                 hover:bg-yellow-300 disabled:opacity-50 disabled:cursor-not-allowed
                 transition-colors">
          @if (loading()) {
            <span class="flex items-center justify-center gap-2">
              <span class="animate-spin inline-block w-4 h-4 border-2 border-black border-t-transparent rounded-full"></span>
              Enviando c√≥digo...
            </span>
          } @else {
            <span>Enviar c√≥digo</span>
          }
        </button>
      </form>
    }

    <!-- PASO 2: Verificar c√≥digo OTP -->
    @if (currentStep() === RecoveryStep.VERIFY) {
      <form (submit)="verifyCode($event)" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-white/70 mb-2 text-center">
            C√≥digo de verificaci√≥n
          </label>
          <input
            [value]="otpCode()"
            (input)="onOtpChange($event)"
            type="text"
            inputmode="numeric"
            required
            maxlength="6"
            placeholder="000000"
            class="w-full px-4 py-4 rounded-lg bg-gray-800 text-white border border-white/10
                   outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-400/20
                   transition-all text-center text-3xl tracking-[0.5em] font-mono"
            autofocus>
          @if (telefono()) {
            <p class="text-xs text-white/40 mt-2 text-center">
              üì± Revisa tu WhatsApp en el n√∫mero <br>
              <span class="text-yellow-400 font-mono">{{ telefono() }}</span>
            </p>
          }
          <p class="text-xs text-white/50 mt-1 text-center">
            El c√≥digo tiene 6 d√≠gitos y expira en 5 minutos
          </p>
        </div>

        <button
          type="submit"
          [disabled]="verifying() || otpCode().length !== 6"
          class="w-full py-3 rounded-xl bg-yellow-400 text-black font-semibold
                 hover:bg-yellow-300 disabled:opacity-50 disabled:cursor-not-allowed
                 transition-colors">
          @if (verifying()) {
            <span class="flex items-center justify-center gap-2">
              <span class="animate-spin inline-block w-4 h-4 border-2 border-black border-t-transparent rounded-full"></span>
              Verificando...
            </span>
          } @else {
            <span>Verificar c√≥digo ({{ otpCode().length }}/6)</span>
          }
        </button>

        <button
          type="button"
          (click)="resendCode()"
          [disabled]="loading()"
          class="w-full py-2 text-sm text-yellow-400 hover:text-yellow-300 
                 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          <span class="flex items-center justify-center gap-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            ¬øNo recibiste el c√≥digo? Reenviar
          </span>
        </button>

        <button
          type="button"
          (click)="goBack()"
          class="w-full py-2 text-sm text-white/50 hover:text-white/70 transition-colors">
          ‚Üê Volver
        </button>
      </form>
    }

    <!-- PASO 3: Nueva contrase√±a -->
    @if (currentStep() === RecoveryStep.RESET) {
      <form (submit)="resetPassword($event)" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-white/70 mb-2">
            Nueva contrase√±a
          </label>
          <input
            [value]="newPassword()"
            (input)="onNewPasswordChange($event)"
            type="password"
            required
            minlength="6"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            autofocus
            class="w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10
                   outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-400/20
                   transition-all">
          <p class="text-xs text-white/40 mt-1">
            M√≠nimo 6 caracteres
          </p>
        </div>

        <div>
          <label class="block text-sm font-medium text-white/70 mb-2">
            Confirmar contrase√±a
          </label>
          <input
            [value]="confirmPassword()"
            (input)="onConfirmPasswordChange($event)"
            type="password"
            required
            minlength="6"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            class="w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10
                   outline-none focus:border-yellow-400 focus:ring-2 focus:ring-yellow-400/20
                   transition-all">
          <p class="text-xs text-white/40 mt-1">
            Debe coincidir con la contrase√±a anterior
          </p>
        </div>

        <!-- Indicador visual de coincidencia -->
        @if (newPassword() && confirmPassword()) {
          @if (newPassword() === confirmPassword()) {
            <div class="flex items-center gap-2 text-green-400 text-sm">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              Las contrase√±as coinciden
            </div>
          } @else {
            <div class="flex items-center gap-2 text-red-400 text-sm">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
              Las contrase√±as no coinciden
            </div>
          }
        }

        <button
          type="submit"
          [disabled]="resetting() || newPassword() !== confirmPassword() || newPassword().length < 6"
          class="w-full py-3 rounded-xl bg-yellow-400 text-black font-semibold
                 hover:bg-yellow-300 disabled:opacity-50 disabled:cursor-not-allowed
                 transition-colors">
          @if (resetting()) {
            <span class="flex items-center justify-center gap-2">
              <span class="animate-spin inline-block w-4 h-4 border-2 border-black border-t-transparent rounded-full"></span>
              Actualizando...
            </span>
          } @else {
            <span>Cambiar contrase√±a</span>
          }
        </button>

        <button
          type="button"
          (click)="goBack()"
          class="w-full py-2 text-sm text-white/50 hover:text-white/70 transition-colors">
          ‚Üê Volver
        </button>
      </form>
    }

    <!-- Footer con enlace a login -->
    <div class="mt-6 text-center text-sm border-t border-white/5 pt-6">
      <span class="text-white/40">¬øRecordaste tu contrase√±a?</span>
      <a routerLink="/login" class="ml-1 font-medium text-yellow-400 hover:text-yellow-300 transition-colors">
        Inicia sesi√≥n
      </a>
    </div>
  </div>
</div>
